![img](https://up.sowevo.com/img/20201224162029.png)

# Dockeræ¦‚è¿°

## Dockerä¸ºä»€ä¹ˆä¼šå‡ºç°?

ç¯å¢ƒé…ç½®çš„éš¾é¢˜:å¼€å‘ç¯å¢ƒ,æµ‹è¯•ç¯å¢ƒ,æ¨¡æ‹Ÿç¯å¢ƒ

å¼€å‘è€…å¸¸å¸¸ä¼šè¯´:å®ƒåœ¨æˆ‘çš„æœºå™¨å¯ä»¥è·‘äº†(It works on my machine),è¨€ä¸‹ä¹‹æ„å°±æ˜¯,å…¶ä»–æœºå™¨å¾ˆå¯èƒ½è·‘ä¸äº†.

å®‰è£…çš„æ—¶å€™,å¯ä¸å¯ä»¥æŠŠåŸå§‹ç¯å¢ƒä¸€æ¨¡ä¸€æ ·åœ°å¤åˆ¶è¿‡æ¥.

**Docker**é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜,æå‡ºäº†è§£å†³æ–¹æ¡ˆ

é€šè¿‡éš”ç¦»æœºåˆ¶å°†æœåŠ¡å™¨å‹æ¦¨åˆ°æè‡´

## Dockerçš„å†å²

2010å¹´,å‡ ä¸ªå¹´è½»äººå¼€äº†å®¶å…¬å¸`dotCloud`

åšä¸€äº›passçš„äº‘è®¡ç®—æŠ€æœ¯,å®¹å™¨çš„æŠ€æœ¯

ä»–ä»¬çš„æŠ€æœ¯å‘½åä¸ºDocker

åæ¥å¹²ä¸ä¸‹å»äº†...è¦å€’é—­

2013å¹´Dockerå°±å¼€æºäº†,å°±ç«äº†

2014å¹´4æœˆ9æ—¥Docker1.0å‘å¸ƒäº†

ä¸ºä»€ä¹ˆè¿™ä¹ˆç«ğŸ”¥?ååˆ†çš„è½»å·§!

å®¹å™¨æŠ€æœ¯ä¹‹å‰,éƒ½æ˜¯ç”¨çš„VMwareè™šæ‹Ÿæœº,ååˆ†ç¬¨é‡

Dockerå®¹å™¨,ä¹Ÿæ˜¯ä¸€ç§è™šæ‹Ÿæœº

> Dockeræ˜¯åŸºäºGoè¯­è¨€å¼€å‘çš„

å®˜ç½‘https://www.docker.com/

æ–‡æ¡£https://docs.docker.com/

ä»“åº“https://hub.docker.com/

## Dockerèƒ½å¹²å•¥!

- è™šæ‹ŸæœºæŠ€æœ¯ç¼ºç‚¹:
  1. èµ„æºå ç”¨å¤š
  2. å†—ä½™æ­¥éª¤å¤š
  3. å¯åŠ¨æ…¢

- å®¹å™¨æŠ€æœ¯
  - å®¹å™¨åŒ–æŠ€æœ¯æ¨¡æ‹Ÿçš„ä¸æ˜¯ä¸€å°å®Œæ•´çš„ç”µè„‘
- Dockeä¸è™šæ‹ŸæœºæŠ€æœ¯çš„ä¸åŒ
  - ä¼ ç»Ÿè™šæ‹Ÿæœº:è™šæ‹Ÿä¸€å †ç¡¬ä»¶,è¿è¡Œä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿ,ç„¶åå†è¿™ä¸ªç³»ç»Ÿä¸Šå®‰è£…å’Œè¿è¡Œè½¯ä»¶
  - Dockerå®¹å™¨:ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„å†…æ ¸,å®¹å™¨æ²¡æœ‰è‡ªå·±çš„å†…æ ¸
  - æ¯ä¸ªå®¹å™¨é—´æ˜¯ç›¸äº’éš”ç¦»çš„,æ²¡ä¸ªå®¹å™¨éƒ½éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿ

> DevOps(å¼€å‘,è¿ç»´)

**åº”ç”¨æ›´å¿«çš„äº¤ä»˜å’Œéƒ¨ç½²**

ä¼ ç»Ÿ:ä¸€å †å¸®åŠ©æ–‡æ¡£,å®‰è£…ç¨‹åº

Docker:æ‰“åŒ…é•œåƒ,å‘å¸ƒæµ‹è¯•,ä¸€é”®è¿è¡Œ

**æ›´ä¾¿æ·çš„å‡çº§å’Œæ‰©ç¼©å®¹**

ä½¿ç”¨äº†Dockerå,é¡¹ç›®éƒ¨ç½²å°±åƒæ­ç§¯æœ¨

é¡¹ç›®æ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒ,ç›´æ¥åœ¨æœåŠ¡å™¨A,æœåŠ¡å™¨Bä¸Šéƒ¨ç½²

**æ›´ç®€å•çš„ç³»ç»Ÿè¿ç»´**

å®¹å™¨åŒ–ä¹‹å,å¼€å‘,æµ‹è¯•,ç¯å¢ƒé«˜åº¦ä¸€è‡´

**æ›´é«˜æ•ˆçš„è®¡ç®—èµ„æºåˆ©ç”¨**

Dockeræ˜¯å†…æ ¸çº§çš„è™šæ‹ŸåŒ–,å¯ä»¥åœ¨ä¸€ä¸ªç‰©ç†æœºä¸Šè¿è¡Œå¾ˆå¤šå®ä¾‹!æœåŠ¡å™¨çš„æ€§èƒ½è¢«å‹æ¦¨åˆ°æè‡´!

# Docker çš„å®‰è£…

## Dockerçš„åŸºæœ¬ç»„æˆ

![img](https://up.sowevo.com/img/20201224173423.png)

- é•œåƒ(Image):
  - Dockeré•œåƒç›¸å½“äºä¸€ä¸ªæ¨¡æ¿,å¯ä»¥é€šè¿‡è¿™ä¸ªæ¨¡æ¿æ¥åˆ›å»ºå®¹å™¨,é•œåƒ==>run==>å®¹å™¨,é€šè¿‡ä¸€ä¸ªé•œåƒå¯ä»¥å¸¸è§å¤šä¸ªå®¹å™¨
- å®¹å™¨(container)
  - Dockeråˆ©ç”¨å®¹å™¨æŠ€æœ¯,ç‹¬ç«‹è¿è¡Œä¸€ä¸ªæˆ–è€…ä¸€ç»„åº”ç”¨,é€šè¿‡é•œåƒæ¥åˆ›å»ºçš„
  - å¯åŠ¨,åœæ­¢,åˆ é™¤ç­‰å‘½ä»¤
  - å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå»ºè®®çš„linuxç³»ç»Ÿ
- ä»“åº“(repository)
  - ä»“åº“å°±æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹
  - ä»“åº“åˆ†ä¸ºå…¬æœ‰ä»“åº“å’Œç§æœ‰ä»“åº“
  - é»˜è®¤æ˜¯å›½å¤–çš„ä»“åº“,å¯ä»¥é…ç½®ä¸ºå›½å†…çš„é•œåƒ

## å®‰è£…

- å®‰è£…

  ```sh
  $ curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
  ```

  å®‰è£…å®Œæˆåï¼ŒDocker æœåŠ¡å°†ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚è¾“å…¥ä¸‹é¢çš„å‘½ä»¤æ¥éªŒè¯ï¼š

  ```shell
  $ sudo systemctl status docker
  ```

  æŸ¥çœ‹å®‰è£…çš„Dockerçš„ç‰ˆæœ¬

  ```shell
  $ docker version  
  ```

  ![image-20201224175422903](https://up.sowevo.com/img/20201224175422.png)

- Zshæ’ä»¶çš„ä½¿ç”¨

  1. ç¡®è®¤å®‰è£…äº†Zsh

  2. ä¿®æ”¹`~/.zshrc`æ–‡ä»¶

  3. æ‰¾åˆ°æ’ä»¶é…ç½®é¡¹`plugins=()`ï¼Œå¢åŠ `docker docker-compose`ä¸¤ä¸ªæ’ä»¶

     ![image-20201224180153473](https://up.sowevo.com/img/20201224180153.png)

  4. `source ~/.zshrc`

- ä½¿ç”¨

  - è¿è¡Œhello-world

    ```shell
    $ docker run hello-world
    ```

    ![image-20201224175629771](https://up.sowevo.com/img/20201224175629.png)

  - æŸ¥çœ‹å®‰è£…çš„é•œåƒ

    ```shell
    $ docker images
    REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
    hello-world   latest    bf756fb1ae65   11 months ago   13.3kB
    ```

## å®¹å™¨åŠ é€Ÿé•œåƒ

```shell
$ sudo mkdir -p /etc/docker
$ sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://ro9g7idi.mirror.aliyuncs.com"]
}
EOF
$ sudo systemctl daemon-reload
$ sudo systemctl restart docker

# è…¾è®¯äº‘å¯ä»¥ç”¨è¿™ä¸ª   https://mirror.ccs.tencentyun.com åœ°å€
```

## åº•å±‚åŸç†

### Dockeræ˜¯æ€ä¹ˆå·¥ä½œçš„

Dockeræ˜¯ä¸€ä¸ªClient-Server(C/S)ç»“æ„çš„ç³»ç»Ÿ,Dockerçš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Š,é€šè¿‡Socketç­‰æ–¹å¼ä»å®¢æˆ·ç«¯è®¿é—®

![img](https://up.sowevo.com/img/20201224201858)

Serveræ”¶åˆ°Clientçš„å‘½ä»¤,å°±ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤

é»˜è®¤æˆ‘ä»¬å®‰è£…çš„DockeråŒ…å«äº†æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯,æ‰€ä»¥æˆ‘ä»¬åœ¨åŒä¸€å°æœåŠ¡å•†çš„æ“ä½œä¹Ÿæ˜¯ç»è¿‡å®¢æˆ·ç«¯==>æœåŠ¡ç«¯è¿™ä¸ªè¿‡ç¨‹çš„

æˆ‘ä»¬å¯ä»¥åœ¨æœ¬æœºå®‰è£…ä¸€ä¸ªå®¢æˆ·ç«¯==>è¿œç¨‹è¿æ¥è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„dockeræœåŠ¡ç«¯

### Dockerä¸ºä»€ä¹ˆæ¯”VMå—?

1. Dockeræ¯”è™šæ‹Ÿæœºæœ‰ç€æ›´å°‘çš„æŠ½è±¡å±‚

2. Dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸,VMæ˜¯éœ€è¦Guest OS

   ![img](https://up.sowevo.com/img/20201224202439.jpg)

â€‹    æ–°å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™,Dockerä¸éœ€è¦åƒVMä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸,é¿å…å¼•å¯¼

# Dockerçš„å¸¸ç”¨å‘½ä»¤

## å¸®åŠ©å‘½ä»¤

```shell
$ docker version  # æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬
$ docker info     # æ˜¾ç¤ºdockerçš„ç³»ç»Ÿä¿¡æ¯
$ docker help     # å¸®åŠ©å‘½ä»¤
```

## é•œåƒå‘½ä»¤

- **dokcer images**: æŸ¥çœ‹æœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ

```shell
$ dokcer images   # æŸ¥çœ‹æœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello-world   latest    bf756fb1ae65   11 months ago   13.3kB
# é€‰é¡¹:
#  -a, --all             æ˜¾ç¤ºæ‰€æœ‰é•œåƒ,ï¼ˆé»˜è®¤éšè—ä¸­é—´é•œåƒï¼‰
#  -f, --filter filter   æ ¹æ®æä¾›çš„æ¡ä»¶è¿‡æ»¤è¾“å‡º
#  -q, --quiet           ä»…æ˜¾ç¤ºID
```

- **docker search**:æœç´¢é•œåƒ

```shell
$ docker search nginx
NAME                               DESCRIPTION                                    STARS     OFFICIAL   AUTOMATED
nginx                              Official build of Nginx.                       14198     [OK]       
jwilder/nginx-proxy                Automated Nginx reverse proxy for docker conâ€¦  1932                 [OK]              
# é€‰é¡¹:
#  -f, --filter filter   æ ¹æ®è¿‡æ»¤æ¡ä»¶è¿›è¡Œè¿‡æ»¤
#      --limit int       ä¸€é¡µæ˜¾ç¤ºå¤šå°‘æ¡
```

- **docker pull**:ä¸‹è½½é•œåƒ

```shell
# å¯ä»¥æŒ‡å®šdocker é•œåƒçš„ç‰ˆæœ¬ 
# docker pull mysql:5.7.9
# å¦‚æœä¸å†™tag,é»˜è®¤å°±æ˜¯latest
$ docker pull mysql
Using default tag: latest
latest: Pulling from library/mysql
6ec7b7d162b2: Pull complete 
fedd960d3481: Pull complete 
7ab947313861: Pull complete 
64f92f19e638: Pull complete 
3e80b17bff96: Pull complete 
014e976799f9: Pull complete 
59ae84fee1b3: Pull complete 
ffe10de703ea: Pull complete 
657af6d90c83: Pull complete 
98bfb480322c: Pull complete 
6aa3859c4789: Pull complete 
1ed875d851ef: Pull complete 
Digest: sha256:78800e6d3f1b230e35275145e657b82c3fb02a27b2d8e76aac2f5e90c1c30873
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest
```

- **docker rmi**:åˆ é™¤é•œåƒ

```shell
# ä¸¤ç§å½¢å¼
# docker rmi é•œåƒid 
# docker rmi é•œåƒå:ç‰ˆæœ¬å· 
$ docker rmi a347a5928046
$ docker rmi hello-world:latest 
```

## å®¹å™¨å‘½ä»¤

- **docker run**:æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨

  ```shell
  $ docker run [å¯é€‰å‚æ•°] images
  # å‚æ•°è¯´æ˜
  --name="name"   å®¹å™¨åç§°   tomcat01,mysql3306,ç”¨æ¥åŒºåˆ†å®¹å™¨
  -d							åå°æ–¹å¼è¿è¡Œ
  -p							æŒ‡å®šå®¹å™¨çš„ç«¯å£
        -p ip:ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
  			-p ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£(å¸¸ç”¨çš„)
  			-p å®¹å™¨ç«¯å£
  -p             æŒ‡å®šéšæœºç«¯å£			
  -i             ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨,é€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨
  -t             ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯,é€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨
  --rm           ç”¨å®Œå°±åˆ é™¤,ä¸€èˆ¬ç”¨æ¥æµ‹è¯•
  ```

  æµ‹è¯•å¯åŠ¨å®¹å™¨

  ```shell
  # å¯åŠ¨centoså®¹å™¨,åŸºç¡€ç‰ˆæœ¬,å¾ˆå¤šå‘½ä»¤éƒ½æ˜¯ä¸å®Œå–„çš„
  $ docker run -it  centos /bin/bash
  ```

- **docker ps**åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨

  ```shell
  $ docker ps
  # å‚æ•°è¯´æ˜
  -a          æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨,åŒ…æ‹¬æ²¡æœ‰åœ¨è¿è¡Œçš„å®¹å™¨
  -n=2        æ˜¾ç¤ºè¿”å›æ¡æ•°
  -q          åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·
  ```

- **docker  rm**åˆ é™¤å®¹å™¨

  ```shell
  $ docker rm å®¹å™¨id    # åˆ é™¤æŒ‡å®šçš„å®¹å™¨
  # å‚æ•°è¯´æ˜
  -f     å¼ºåˆ¶åˆ é™¤
  ```

- å¯åŠ¨å’Œåœæ­¢å®¹å™¨

  ```shell
  $ docker start   å®¹å™¨id   # å¯åŠ¨å®¹å™¨
  $ docker stop    å®¹å™¨id    # åœæ­¢å®¹å™¨
  $ docker restart å®¹å™¨id # é‡å¯å®¹å™¨
  $ docker kill    å®¹å™¨id    # å¼ºåˆ¶åœæ­¢å®¹å™¨
  ```

## å¸¸ç”¨å…¶ä»–å‘½ä»¤

- **docker stats** æŸ¥çœ‹å®¹å™¨ä½¿ç”¨èµ„æºæƒ…å†µ

  ```shell
  # è¿”å›å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ,ä¸€ç§’åˆ·æ–°ä¸€æ¬¡
  $ docker stats
  # è¿”å›å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ,ä¸åˆ·æ–°
  $ docker stats --no-stream
  # è¿”å›å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ,å·²ç»åœæ‰çš„ä¹Ÿæ˜¾ç¤º
  $ docker stats -a
  # è¿”å›æŒ‡å®šå®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
  $ docker stats å®¹å™¨id
  ```

- åå°å¯åŠ¨å®¹å™¨**-d**

  ```shell
  # -d åå°å¯åŠ¨
  $ docker run -d centos
  ```

- **docker logs**æŸ¥çœ‹æ—¥å¿—

  ```shell
  $ docker logs -tf --tail 10 å®¹å™¨id
  # docker logs [OPTIONS] CONTAINER
  # OPTIONSè¯´æ˜ï¼š
  -f       è·Ÿè¸ªæ—¥å¿—è¾“å‡º
  -t       æ˜¾ç¤ºæ—¶é—´æˆ³
  --since  æ˜¾ç¤ºæŸä¸ªå¼€å§‹æ—¶é—´çš„æ‰€æœ‰æ—¥å¿—
  --tail   ä»…åˆ—å‡ºæœ€æ–°Næ¡å®¹å™¨æ—¥å¿—
  ```

- **docker top**æŸ¥çœ‹å®¹å™¨ä¸­çš„è¿›ç¨‹ä¿¡æ¯

  ```shell
  # docker top å®¹å™¨id
  $ docker top 919121a5a1a6
  ```

- **docker inspect** æŸ¥çœ‹å®¹å™¨çš„å…ƒæ•°æ®

  ```shell
  # docker inspect å®¹å™¨id
  $ docker inspect 919121a5a1a6
  ```

- è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨

  - é€šå¸¸éƒ½æ˜¯åå°è¿è¡Œçš„,éœ€è¦è¿›å…¥å®¹å™¨,ä¿®æ”¹é…ç½®ä¹‹ç±»çš„
  
  - æ–¹å¼ä¸€**docker exec**
  
    ```bash
    # å‘½ä»¤
    # docker exec -it å®¹å™¨id /bin/bash
    $ docker exec -it 919121a5a1a6 /bin/bash
    ```
  
  - æ–¹å¼äºŒ**docker attach**
  
      ```shell
      # å‘½ä»¤
      # docker attach å®¹å™¨id
      $ docker attach 919121a5a1a6
      ```
  
  - ä¸¤ç§æ–¹å¼çš„åŒºåˆ«
    - docker exec     åœ¨å®¹å™¨ä¸­å¯åŠ¨æ–°çš„ç»ˆç«¯
    - docker attach  è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œå‘½ä»¤çš„é‚£ä¸ªç»ˆç«¯.

- **docker ps**ä»å®¹å™¨æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š

  ```shell
  # docker cp å®¹å™¨id:å®¹å™¨å†…çš„æ–‡ä»¶å å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å
  $ docker cp 919121a5a1a6:/root/123456.txt /root
  
  
  # docker cp å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å å®¹å™¨id:å®¹å™¨å†…çš„æ–‡ä»¶å
  $ docker cp /root/123456.txt 919121a5a1a6:/root
  ```

## æ¡ˆä¾‹

### nginx

```shell
# docker run -d -p 1234:80 --name nginx-1234 nginx
# -d åå°è¿è¡Œ
# -p ç«¯å£æ˜ å°„
# --name nginx-1234 å®¹å™¨çš„åç§°
$ docker run -d -p 1234:80 --name nginx-1234 nginx
```

### tomcat

```shell
# docker run -it -p 8080:8080 --name tomcat8080 tomcat
# -it äº¤äº’å¼å¯åŠ¨
# -p ç«¯å£æ˜ å°„
# --name tomcat8080 å®¹å™¨çš„åç§°
$ docker run -it -p 8080:8080 --name tomcat8080 tomcat
```

### elasticsearch

```shell
# docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.10.1
# -d  åå°è¿è¡Œ
# -p  ç«¯å£æ˜ å°„,æœ‰ä¸¤ä¸ª
# -e  é•œåƒçš„ç¯å¢ƒå‚æ•° å…·ä½“ç”±é•œåƒæ¥æŒ‡å®š,çœ‹ä¸‹é•œåƒçš„æ–‡æ¡£
# --name elasticsearch å®¹å™¨çš„åç§°
$ docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e "ES_JAVA_OPTS=-Xms64m -Xmx512m" elasticsearch:7.10.1
```

## æ€»ç»“

![img](https://up.sowevo.com/img/20201224224200.png)

# å¯è§†åŒ–

## portainer

- å®‰è£…

  ```shell
  $ docker run -d -p 8000:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer 
  ```

- ç”¨çš„æ¯”è¾ƒå°‘

## Rancher





